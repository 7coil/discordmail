{"id":"BkE3","dependencies":[{"name":"C:\\Users\\Leond\\Documents\\Programming\\discordmailhooks\\src\\mail\\package.json","includedInParent":true,"mtime":1586483651797}],"generated":{"js":"\"use strict\";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,\"__esModule\",{value:!0});var t,n=e(require(\"node-fetch\")),r=e(require(\"form-data\"));!function(e){e[e.WEBHOOK_ACCOUNT=0]=\"WEBHOOK_ACCOUNT\",e[e.USER_ACCOUNT=1]=\"USER_ACCOUNT\"}(t||(t={}));var i=function(){function e(e){var t=e.id,n=e.type,r=e.payload;this.id=t,this.type=n,this.payload=r}return e.prototype.sendMail=function(e){if(this.type===t.WEBHOOK_ACCOUNT){var i=new r.default;i.append(\"payload_json\",JSON.stringify(e.getEmbed())),n.default(this.payload,{method:\"POST\",body:i})}},e.getAccountFromEmail=function(t,n){return new Promise(function(r,i){if(!n.toLowerCase().endsWith(\"@\"+process.env.DOMAIN_NAME))return r(null);var o=n.substring(0,n.length-process.env.DOMAIN_NAME.length-1);t.query(\"SELECT * FROM accounts WHERE id = ?\",[o],function(t,n,o){if(!t)return 0===n.length?r(null):r(new e(n[0]));i(t)})})},e}();exports.default=i;"},"sourceMaps":{"js":{"mappings":[{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":0}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":13}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":17}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":19}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":25}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":30}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":47}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":56}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":59}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":66}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":69}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":71}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":82}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":84}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":85}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":93}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":97}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":104}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":119}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":127}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":140}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":141}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":148}},{"source":"Account.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":152}},{"source":"Account.ts","name":null,"original":{"line":6,"column":5},"generated":{"line":1,"column":156}},{"source":"Account.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":158}},{"source":"Account.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":160}},{"source":"Account.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":162}},{"source":"Account.ts","name":null,"original":{"line":2,"column":0},"generated":{"line":1,"column":170}},{"source":"Account.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":185}},{"source":"Account.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":187}},{"source":"Account.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":189}},{"source":"Account.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":197}},{"source":"Account.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":212}},{"source":"Account.ts","name":null,"original":{"line":6,"column":5},"generated":{"line":1,"column":221}},{"source":"Account.ts","name":null,"original":{"line":7,"column":2},"generated":{"line":1,"column":224}},{"source":"Account.ts","name":null,"original":{"line":7,"column":2},"generated":{"line":1,"column":226}},{"source":"Account.ts","name":null,"original":{"line":7,"column":2},"generated":{"line":1,"column":228}},{"source":"Account.ts","name":null,"original":{"line":7,"column":2},"generated":{"line":1,"column":244}},{"source":"Account.ts","name":null,"original":{"line":7,"column":2},"generated":{"line":1,"column":247}},{"source":"Account.ts","name":null,"original":{"line":8,"column":2},"generated":{"line":1,"column":265}},{"source":"Account.ts","name":null,"original":{"line":8,"column":2},"generated":{"line":1,"column":267}},{"source":"Account.ts","name":null,"original":{"line":8,"column":2},"generated":{"line":1,"column":269}},{"source":"Account.ts","name":null,"original":{"line":8,"column":2},"generated":{"line":1,"column":282}},{"source":"Account.ts","name":null,"original":{"line":8,"column":2},"generated":{"line":1,"column":285}},{"source":"Account.ts","name":null,"original":{"line":6,"column":0},"generated":{"line":1,"column":300}},{"source":"Account.ts","name":null,"original":{"line":6,"column":5},"generated":{"line":1,"column":301}},{"source":"Account.ts","name":null,"original":{"line":6,"column":5},"generated":{"line":1,"column":305}},{"source":"Account.ts","name":null,"original":{"line":6,"column":17},"generated":{"line":1,"column":307}},{"source":"Account.ts","name":null,"original":{"line":11,"column":0},"generated":{"line":1,"column":312}},{"source":"Account.ts","name":null,"original":{"line":11,"column":0},"generated":{"line":1,"column":316}},{"source":"Account.ts","name":null,"original":{"line":11,"column":0},"generated":{"line":1,"column":318}},{"source":"Account.ts","name":null,"original":{"line":16,"column":2},"generated":{"line":1,"column":329}},{"source":"Account.ts","name":null,"original":{"line":16,"column":2},"generated":{"line":1,"column":338}},{"source":"Account.ts","name":null,"original":{"line":16,"column":14},"generated":{"line":1,"column":340}},{"source":"Account.ts","name":null,"original":{"line":17,"column":4},"generated":{"line":1,"column":343}},{"source":"Account.ts","name":null,"original":{"line":17,"column":4},"generated":{"line":1,"column":347}},{"source":"Account.ts","name":null,"original":{"line":17,"column":4},"generated":{"line":1,"column":349}},{"source":"Account.ts","name":null,"original":{"line":17,"column":4},"generated":{"line":1,"column":351}},{"source":"Account.ts","name":null,"original":{"line":17,"column":8},"generated":{"line":1,"column":354}},{"source":"Account.ts","name":null,"original":{"line":17,"column":8},"generated":{"line":1,"column":356}},{"source":"Account.ts","name":null,"original":{"line":17,"column":8},"generated":{"line":1,"column":358}},{"source":"Account.ts","name":null,"original":{"line":17,"column":14},"generated":{"line":1,"column":363}},{"source":"Account.ts","name":null,"original":{"line":17,"column":14},"generated":{"line":1,"column":365}},{"source":"Account.ts","name":null,"original":{"line":17,"column":14},"generated":{"line":1,"column":367}},{"source":"Account.ts","name":null,"original":{"line":23,"column":9},"generated":{"line":1,"column":375}},{"source":"Account.ts","name":null,"original":{"line":23,"column":9},"generated":{"line":1,"column":380}},{"source":"Account.ts","name":null,"original":{"line":23,"column":14},"generated":{"line":1,"column":383}},{"source":"Account.ts","name":null,"original":{"line":24,"column":9},"generated":{"line":1,"column":385}},{"source":"Account.ts","name":null,"original":{"line":24,"column":9},"generated":{"line":1,"column":390}},{"source":"Account.ts","name":null,"original":{"line":24,"column":16},"generated":{"line":1,"column":395}},{"source":"Account.ts","name":null,"original":{"line":25,"column":9},"generated":{"line":1,"column":397}},{"source":"Account.ts","name":null,"original":{"line":25,"column":9},"generated":{"line":1,"column":402}},{"source":"Account.ts","name":null,"original":{"line":25,"column":19},"generated":{"line":1,"column":410}},{"source":"Account.ts","name":null,"original":{"line":58,"column":0},"generated":{"line":1,"column":412}},{"source":"Account.ts","name":null,"original":{"line":28,"column":2},"generated":{"line":1,"column":419}},{"source":"Account.ts","name":null,"original":{"line":28,"column":2},"generated":{"line":1,"column":421}},{"source":"Account.ts","name":null,"original":{"line":28,"column":2},"generated":{"line":1,"column":431}},{"source":"Account.ts","name":null,"original":{"line":28,"column":2},"generated":{"line":1,"column":440}},{"source":"Account.ts","name":null,"original":{"line":28,"column":11},"generated":{"line":1,"column":449}},{"source":"Account.ts","name":null,"original":{"line":29,"column":8},"generated":{"line":1,"column":452}},{"source":"Account.ts","name":null,"original":{"line":29,"column":8},"generated":{"line":1,"column":455}},{"source":"Account.ts","name":null,"original":{"line":29,"column":13},"generated":{"line":1,"column":460}},{"source":"Account.ts","name":null,"original":{"line":29,"column":22},"generated":{"line":1,"column":467}},{"source":"Account.ts","name":null,"original":{"line":29,"column":35},"generated":{"line":1,"column":469}},{"source":"Account.ts","name":null,"original":{"line":29,"column":52},"generated":{"line":1,"column":485}},{"source":"Account.ts","name":null,"original":{"line":30,"column":12},"generated":{"line":1,"column":486}},{"source":"Account.ts","name":null,"original":{"line":30,"column":12},"generated":{"line":1,"column":490}},{"source":"Account.ts","name":null,"original":{"line":30,"column":19},"generated":{"line":1,"column":492}},{"source":"Account.ts","name":null,"original":{"line":30,"column":23},"generated":{"line":1,"column":496}},{"source":"Account.ts","name":null,"original":{"line":30,"column":23},"generated":{"line":1,"column":498}},{"source":"Account.ts","name":null,"original":{"line":31,"column":6},"generated":{"line":1,"column":506}},{"source":"Account.ts","name":null,"original":{"line":31,"column":11},"generated":{"line":1,"column":508}},{"source":"Account.ts","name":null,"original":{"line":31,"column":18},"generated":{"line":1,"column":515}},{"source":"Account.ts","name":null,"original":{"line":31,"column":34},"generated":{"line":1,"column":530}},{"source":"Account.ts","name":null,"original":{"line":31,"column":39},"generated":{"line":1,"column":535}},{"source":"Account.ts","name":null,"original":{"line":31,"column":49},"generated":{"line":1,"column":545}},{"source":"Account.ts","name":null,"original":{"line":31,"column":54},"generated":{"line":1,"column":547}},{"source":"Account.ts","name":null,"original":{"line":33,"column":6},"generated":{"line":1,"column":560}},{"source":"Account.ts","name":null,"original":{"line":33,"column":6},"generated":{"line":1,"column":562}},{"source":"Account.ts","name":null,"original":{"line":33,"column":12},"generated":{"line":1,"column":570}},{"source":"Account.ts","name":null,"original":{"line":33,"column":17},"generated":{"line":1,"column":575}},{"source":"Account.ts","name":null,"original":{"line":33,"column":26},"generated":{"line":1,"column":583}},{"source":"Account.ts","name":null,"original":{"line":34,"column":8},"generated":{"line":1,"column":584}},{"source":"Account.ts","name":null,"original":{"line":34,"column":16},"generated":{"line":1,"column":591}},{"source":"Account.ts","name":null,"original":{"line":35,"column":8},"generated":{"line":1,"column":598}},{"source":"Account.ts","name":null,"original":{"line":35,"column":14},"generated":{"line":1,"column":603}},{"source":"Account.ts","name":null,"original":{"line":40,"column":9},"generated":{"line":1,"column":609}},{"source":"Account.ts","name":null,"original":{"line":40,"column":9},"generated":{"line":1,"column":611}},{"source":"Account.ts","name":null,"original":{"line":40,"column":2},"generated":{"line":1,"column":631}},{"source":"Account.ts","name":null,"original":{"line":40,"column":29},"generated":{"line":1,"column":640}},{"source":"Account.ts","name":null,"original":{"line":40,"column":45},"generated":{"line":1,"column":642}},{"source":"Account.ts","name":null,"original":{"line":41,"column":11},"generated":{"line":1,"column":645}},{"source":"Account.ts","name":null,"original":{"line":41,"column":11},"generated":{"line":1,"column":652}},{"source":"Account.ts","name":null,"original":{"line":41,"column":15},"generated":{"line":1,"column":656}},{"source":"Account.ts","name":null,"original":{"line":41,"column":23},"generated":{"line":1,"column":664}},{"source":"Account.ts","name":null,"original":{"line":41,"column":24},"generated":{"line":1,"column":673}},{"source":"Account.ts","name":null,"original":{"line":41,"column":33},"generated":{"line":1,"column":675}},{"source":"Account.ts","name":null,"original":{"line":44,"column":10},"generated":{"line":1,"column":678}},{"source":"Account.ts","name":null,"original":{"line":42,"column":35},"generated":{"line":1,"column":682}},{"source":"Account.ts","name":null,"original":{"line":42,"column":41},"generated":{"line":1,"column":684}},{"source":"Account.ts","name":null,"original":{"line":44,"column":32},"generated":{"line":1,"column":698}},{"source":"Account.ts","name":null,"original":{"line":44,"column":41},"generated":{"line":1,"column":707}},{"source":"Account.ts","name":null,"original":{"line":44,"column":47},"generated":{"line":1,"column":711}},{"source":"Account.ts","name":null,"original":{"line":44,"column":55},"generated":{"line":1,"column":719}},{"source":"Account.ts","name":null,"original":{"line":44,"column":59},"generated":{"line":1,"column":723}},{"source":"Account.ts","name":null,"original":{"line":44,"column":73},"generated":{"line":1,"column":736}},{"source":"Account.ts","name":null,"original":{"line":44,"column":80},"generated":{"line":1,"column":743}},{"source":"Account.ts","name":null,"original":{"line":44,"column":88},"generated":{"line":1,"column":745}},{"source":"Account.ts","name":null,"original":{"line":46,"column":12},"generated":{"line":1,"column":751}},{"source":"Account.ts","name":null,"original":{"line":46,"column":12},"generated":{"line":1,"column":755}},{"source":"Account.ts","name":null,"original":{"line":46,"column":28},"generated":{"line":1,"column":757}},{"source":"Account.ts","name":null,"original":{"line":46,"column":34},"generated":{"line":1,"column":759}},{"source":"Account.ts","name":null,"original":{"line":46,"column":44},"generated":{"line":1,"column":769}},{"source":"Account.ts","name":null,"original":{"line":46,"column":47},"generated":{"line":1,"column":771}},{"source":"Account.ts","name":null,"original":{"line":46,"column":53},"generated":{"line":1,"column":773}},{"source":"Account.ts","name":null,"original":{"line":46,"column":62},"generated":{"line":1,"column":780}},{"source":"Account.ts","name":null,"original":{"line":46,"column":70},"generated":{"line":1,"column":788}},{"source":"Account.ts","name":null,"original":{"line":46,"column":74},"generated":{"line":1,"column":792}},{"source":"Account.ts","name":null,"original":{"line":46,"column":86},"generated":{"line":1,"column":804}},{"source":"Account.ts","name":null,"original":{"line":46,"column":95},"generated":{"line":1,"column":811}},{"source":"Account.ts","name":null,"original":{"line":48,"column":6},"generated":{"line":1,"column":814}},{"source":"Account.ts","name":null,"original":{"line":48,"column":9},"generated":{"line":1,"column":816}},{"source":"Account.ts","name":null,"original":{"line":48,"column":15},"generated":{"line":1,"column":822}},{"source":"Account.ts","name":null,"original":{"line":48,"column":54},"generated":{"line":1,"column":860}},{"source":"Account.ts","name":null,"original":{"line":48,"column":55},"generated":{"line":1,"column":861}},{"source":"Account.ts","name":null,"original":{"line":48,"column":71},"generated":{"line":1,"column":864}},{"source":"Account.ts","name":null,"original":{"line":48,"column":72},"generated":{"line":1,"column":873}},{"source":"Account.ts","name":null,"original":{"line":48,"column":77},"generated":{"line":1,"column":875}},{"source":"Account.ts","name":null,"original":{"line":48,"column":86},"generated":{"line":1,"column":877}},{"source":"Account.ts","name":null,"original":{"line":49,"column":12},"generated":{"line":1,"column":880}},{"source":"Account.ts","name":null,"original":{"line":49,"column":12},"generated":{"line":1,"column":884}},{"source":"Account.ts","name":null,"original":{"line":52,"column":14},"generated":{"line":1,"column":886}},{"source":"Account.ts","name":null,"original":{"line":52,"column":33},"generated":{"line":1,"column":893}},{"source":"Account.ts","name":null,"original":{"line":52,"column":14},"generated":{"line":1,"column":897}},{"source":"Account.ts","name":null,"original":{"line":52,"column":22},"generated":{"line":1,"column":899}},{"source":"Account.ts","name":null,"original":{"line":52,"column":43},"generated":{"line":1,"column":906}},{"source":"Account.ts","name":null,"original":{"line":52,"column":51},"generated":{"line":1,"column":908}},{"source":"Account.ts","name":null,"original":{"line":53,"column":17},"generated":{"line":1,"column":914}},{"source":"Account.ts","name":null,"original":{"line":53,"column":25},"generated":{"line":1,"column":916}},{"source":"Account.ts","name":null,"original":{"line":53,"column":29},"generated":{"line":1,"column":920}},{"source":"Account.ts","name":null,"original":{"line":53,"column":37},"generated":{"line":1,"column":922}},{"source":"Account.ts","name":null,"original":{"line":53,"column":45},"generated":{"line":1,"column":924}},{"source":"Account.ts","name":null,"original":{"line":50,"column":10},"generated":{"line":1,"column":929}},{"source":"Account.ts","name":null,"original":{"line":50,"column":17},"generated":{"line":1,"column":931}},{"source":"Account.ts","name":null,"original":{"line":58,"column":0},"generated":{"line":1,"column":939}},{"source":"Account.ts","name":null,"original":{"line":11,"column":0},"generated":{"line":1,"column":941}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":944}},{"source":"Account.ts","name":null,"original":{"line":60,"column":0},"generated":{"line":1,"column":952}},{"source":"Account.ts","name":null,"original":{"line":60,"column":15},"generated":{"line":1,"column":960}}],"sources":{"Account.ts":"import { Connection } from 'mysql';\nimport fetch from 'node-fetch';\nimport Mail from './Mail';\nimport FormData from 'form-data';\n\nenum AccountTypes {\n  WEBHOOK_ACCOUNT = 0,\n  USER_ACCOUNT = 1\n}\n\nclass Account {\n  id: string\n  type: AccountTypes\n  payload: string\n\n  constructor({\n    id, type, payload\n  }: {\n    id: string,\n    type: AccountTypes,\n    payload: string,\n  }) {\n    this.id = id;\n    this.type = type;\n    this.payload = payload;\n  }\n\n  sendMail(mail: Mail) {\n    if (this.type === AccountTypes.WEBHOOK_ACCOUNT) {\n      const form = new FormData();\n      form.append('payload_json', JSON.stringify(mail.getEmbed()));\n\n      fetch(this.payload, {\n        method: 'POST',\n        body: form\n      })\n    }\n  }\n\n  static getAccountFromEmail(db: Connection, email: string): Promise<Account> {\n    return new Promise((resolve, reject) => {\n      const lowercaseEmailString = email.toLowerCase();\n\n      if (!lowercaseEmailString.endsWith('@' + process.env.DOMAIN_NAME)) return resolve(null);\n      \n      const remainingPart = email.substring(0, email.length - process.env.DOMAIN_NAME.length - 1);\n\n      db.query('SELECT * FROM accounts WHERE id = ?', [remainingPart], (err, results, fields) => {\n        if (err) {\n          reject(err);\n        } else {\n          if (results.length === 0) return resolve(null);\n          return resolve(new Account(results[0]))\n        }\n      })\n    })\n  }\n}\n\nexport default Account\n"},"lineCount":null}},"error":null,"hash":"d56e9446c29ac125fc0e53e0c29a6d03","cacheData":{"env":{}}}