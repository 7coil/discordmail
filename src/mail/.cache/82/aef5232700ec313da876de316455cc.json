{"id":"p4wU","dependencies":[{"name":"C:\\Users\\Leond\\Documents\\Programming\\discordmailhooks\\src\\mail\\package.json","includedInParent":true,"mtime":1586483651797},{"name":"./Account","loc":{"line":6,"column":40},"parent":"C:\\Users\\Leond\\Documents\\Programming\\discordmailhooks\\src\\mail\\Mail.ts","resolved":"C:\\Users\\Leond\\Documents\\Programming\\discordmailhooks\\src\\mail\\Account.ts"}],"generated":{"js":"\"use strict\";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,\"__esModule\",{value:!0});var e=t(require(\"./Account\")),n=t(require(\"html-to-text\")),i=function(){function t(t){var e=t.mail,n=t.stream,i=t.session,o=t.callback,s=t.sqlConnection;this.mailObject=e,this.stream=n,this.session=i,this.callback=o,this.sqlConnection=s,this.dateLoaded=new Date}return t.prototype.contentRequiresConversion=function(){return!this.mailObject.text&&!!this.mailObject.html},t.prototype.contentRequiresTruncation=function(){return null!==this.getContents()&&this.getContents().length>2e3},t.prototype.emailContainsAttachments=function(){return this.mailObject.attachments.length>0},t.prototype.getRecipient=function(){var t=this;return new Promise(function(n,i){var o=[];t.mailObject.to&&o.push.apply(o,t.mailObject.to.value.map(function(t){return t.address})),t.mailObject.headers.get(\"x-forwarded-to\")&&o.push(t.mailObject.headers.get(\"x-forwarded-to\")),t.session.envelope.rcptTo.length>0&&o.push.apply(o,t.session.envelope.rcptTo.map(function(t){return t.address})),Promise.all(o.map(function(n){return e.default.getAccountFromEmail(t.sqlConnection,n)})).then(function(t){var e=t.filter(function(t){return!!t});n(e[0]||null)})})},t.prototype.getTitle=function(){return this.mailObject.subject||\"_Untitled E-Mail_\"},t.prototype.getAuthor=function(){return this.mailObject.from?this.mailObject.from.text.length>256?this.mailObject.from.text.substring(0,250)+\"...\":this.mailObject.from.text:\"_No Author Identified_\"},t.prototype.getContents=function(){return this.contentRequiresConversion()?!1===this.mailObject.html?null:n.default.fromString(this.mailObject.html):0===this.mailObject.text.trim().length?null:this.mailObject.text},t.prototype.getTruncatedContents=function(){return this.contentRequiresTruncation()?this.getContents().substring(0,1995)+\"...\":this.getContents()},t.prototype.getDate=function(){return this.mailObject.date||this.dateLoaded},t.prototype.getEmbed=function(){var t=[];return this.contentRequiresConversion()&&t.push({name:\"Note\",value:\"This email has been converted from _HTML_ to _Plain Text_.\"}),this.contentRequiresTruncation()&&t.push({name:\"Note\",value:\"This email has been truncated to fit under 2000 characters.\"}),this.emailContainsAttachments()&&t.push({name:\"Attachments\",value:\"This email contains attachments.\"}),{title:this.getTitle(),description:this.getTruncatedContents(),timestamp:this.getDate(),author:{name:this.getAuthor()},fields:t,footer:{text:\"https://discordmail.com/\"}}},t}();exports.default=i;"},"sourceMaps":{"js":{"mappings":[{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":0}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":13}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":17}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":19}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":25}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":30}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":47}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":56}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":59}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":66}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":69}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":71}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":82}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":84}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":85}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":93}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":97}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":104}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":119}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":127}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":140}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":141}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":148}},{"source":"Mail.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":152}},{"source":"Mail.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":156}},{"source":"Mail.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":158}},{"source":"Mail.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":160}},{"source":"Mail.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":168}},{"source":"Mail.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":1,"column":182}},{"source":"Mail.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":1,"column":184}},{"source":"Mail.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":1,"column":186}},{"source":"Mail.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":1,"column":194}},{"source":"Mail.ts","name":null,"original":{"line":7,"column":0},"generated":{"line":1,"column":211}},{"source":"Mail.ts","name":null,"original":{"line":7,"column":0},"generated":{"line":1,"column":213}},{"source":"Mail.ts","name":null,"original":{"line":15,"column":2},"generated":{"line":1,"column":224}},{"source":"Mail.ts","name":null,"original":{"line":15,"column":2},"generated":{"line":1,"column":233}},{"source":"Mail.ts","name":null,"original":{"line":15,"column":14},"generated":{"line":1,"column":235}},{"source":"Mail.ts","name":null,"original":{"line":16,"column":4},"generated":{"line":1,"column":238}},{"source":"Mail.ts","name":null,"original":{"line":16,"column":4},"generated":{"line":1,"column":242}},{"source":"Mail.ts","name":null,"original":{"line":16,"column":4},"generated":{"line":1,"column":244}},{"source":"Mail.ts","name":null,"original":{"line":16,"column":4},"generated":{"line":1,"column":246}},{"source":"Mail.ts","name":null,"original":{"line":17,"column":4},"generated":{"line":1,"column":251}},{"source":"Mail.ts","name":null,"original":{"line":17,"column":4},"generated":{"line":1,"column":253}},{"source":"Mail.ts","name":null,"original":{"line":17,"column":4},"generated":{"line":1,"column":255}},{"source":"Mail.ts","name":null,"original":{"line":18,"column":4},"generated":{"line":1,"column":262}},{"source":"Mail.ts","name":null,"original":{"line":18,"column":4},"generated":{"line":1,"column":264}},{"source":"Mail.ts","name":null,"original":{"line":18,"column":4},"generated":{"line":1,"column":266}},{"source":"Mail.ts","name":null,"original":{"line":19,"column":4},"generated":{"line":1,"column":274}},{"source":"Mail.ts","name":null,"original":{"line":19,"column":4},"generated":{"line":1,"column":276}},{"source":"Mail.ts","name":null,"original":{"line":19,"column":4},"generated":{"line":1,"column":278}},{"source":"Mail.ts","name":null,"original":{"line":20,"column":4},"generated":{"line":1,"column":287}},{"source":"Mail.ts","name":null,"original":{"line":20,"column":4},"generated":{"line":1,"column":289}},{"source":"Mail.ts","name":null,"original":{"line":20,"column":4},"generated":{"line":1,"column":291}},{"source":"Mail.ts","name":null,"original":{"line":28,"column":9},"generated":{"line":1,"column":305}},{"source":"Mail.ts","name":null,"original":{"line":28,"column":9},"generated":{"line":1,"column":310}},{"source":"Mail.ts","name":null,"original":{"line":28,"column":22},"generated":{"line":1,"column":321}},{"source":"Mail.ts","name":null,"original":{"line":29,"column":9},"generated":{"line":1,"column":323}},{"source":"Mail.ts","name":null,"original":{"line":29,"column":9},"generated":{"line":1,"column":328}},{"source":"Mail.ts","name":null,"original":{"line":29,"column":18},"generated":{"line":1,"column":335}},{"source":"Mail.ts","name":null,"original":{"line":30,"column":9},"generated":{"line":1,"column":337}},{"source":"Mail.ts","name":null,"original":{"line":30,"column":9},"generated":{"line":1,"column":342}},{"source":"Mail.ts","name":null,"original":{"line":30,"column":19},"generated":{"line":1,"column":350}},{"source":"Mail.ts","name":null,"original":{"line":31,"column":9},"generated":{"line":1,"column":352}},{"source":"Mail.ts","name":null,"original":{"line":31,"column":9},"generated":{"line":1,"column":357}},{"source":"Mail.ts","name":null,"original":{"line":31,"column":20},"generated":{"line":1,"column":366}},{"source":"Mail.ts","name":null,"original":{"line":32,"column":9},"generated":{"line":1,"column":368}},{"source":"Mail.ts","name":null,"original":{"line":32,"column":9},"generated":{"line":1,"column":373}},{"source":"Mail.ts","name":null,"original":{"line":32,"column":25},"generated":{"line":1,"column":387}},{"source":"Mail.ts","name":null,"original":{"line":33,"column":9},"generated":{"line":1,"column":389}},{"source":"Mail.ts","name":null,"original":{"line":33,"column":9},"generated":{"line":1,"column":394}},{"source":"Mail.ts","name":null,"original":{"line":33,"column":22},"generated":{"line":1,"column":405}},{"source":"Mail.ts","name":null,"original":{"line":33,"column":26},"generated":{"line":1,"column":409}},{"source":"Mail.ts","name":null,"original":{"line":146,"column":0},"generated":{"line":1,"column":414}},{"source":"Mail.ts","name":null,"original":{"line":39,"column":2},"generated":{"line":1,"column":421}},{"source":"Mail.ts","name":null,"original":{"line":39,"column":2},"generated":{"line":1,"column":423}},{"source":"Mail.ts","name":null,"original":{"line":39,"column":2},"generated":{"line":1,"column":433}},{"source":"Mail.ts","name":null,"original":{"line":39,"column":2},"generated":{"line":1,"column":459}},{"source":"Mail.ts","name":null,"original":{"line":40,"column":8},"generated":{"line":1,"column":470}},{"source":"Mail.ts","name":null,"original":{"line":40,"column":8},"generated":{"line":1,"column":477}},{"source":"Mail.ts","name":null,"original":{"line":40,"column":13},"generated":{"line":1,"column":482}},{"source":"Mail.ts","name":null,"original":{"line":40,"column":24},"generated":{"line":1,"column":493}},{"source":"Mail.ts","name":null,"original":{"line":41,"column":8},"generated":{"line":1,"column":501}},{"source":"Mail.ts","name":null,"original":{"line":41,"column":13},"generated":{"line":1,"column":506}},{"source":"Mail.ts","name":null,"original":{"line":41,"column":24},"generated":{"line":1,"column":517}},{"source":"Mail.ts","name":null,"original":{"line":45,"column":2},"generated":{"line":1,"column":523}},{"source":"Mail.ts","name":null,"original":{"line":45,"column":2},"generated":{"line":1,"column":525}},{"source":"Mail.ts","name":null,"original":{"line":45,"column":2},"generated":{"line":1,"column":535}},{"source":"Mail.ts","name":null,"original":{"line":45,"column":2},"generated":{"line":1,"column":561}},{"source":"Mail.ts","name":null,"original":{"line":46,"column":8},"generated":{"line":1,"column":572}},{"source":"Mail.ts","name":null,"original":{"line":46,"column":31},"generated":{"line":1,"column":579}},{"source":"Mail.ts","name":null,"original":{"line":46,"column":8},"generated":{"line":1,"column":586}},{"source":"Mail.ts","name":null,"original":{"line":46,"column":13},"generated":{"line":1,"column":591}},{"source":"Mail.ts","name":null,"original":{"line":47,"column":11},"generated":{"line":1,"column":606}},{"source":"Mail.ts","name":null,"original":{"line":47,"column":16},"generated":{"line":1,"column":611}},{"source":"Mail.ts","name":null,"original":{"line":47,"column":30},"generated":{"line":1,"column":625}},{"source":"Mail.ts","name":null,"original":{"line":47,"column":39},"generated":{"line":1,"column":632}},{"source":"Mail.ts","name":null,"original":{"line":50,"column":2},"generated":{"line":1,"column":637}},{"source":"Mail.ts","name":null,"original":{"line":50,"column":2},"generated":{"line":1,"column":639}},{"source":"Mail.ts","name":null,"original":{"line":50,"column":2},"generated":{"line":1,"column":649}},{"source":"Mail.ts","name":null,"original":{"line":50,"column":2},"generated":{"line":1,"column":674}},{"source":"Mail.ts","name":null,"original":{"line":51,"column":11},"generated":{"line":1,"column":685}},{"source":"Mail.ts","name":null,"original":{"line":51,"column":11},"generated":{"line":1,"column":692}},{"source":"Mail.ts","name":null,"original":{"line":51,"column":16},"generated":{"line":1,"column":697}},{"source":"Mail.ts","name":null,"original":{"line":51,"column":27},"generated":{"line":1,"column":708}},{"source":"Mail.ts","name":null,"original":{"line":51,"column":39},"generated":{"line":1,"column":720}},{"source":"Mail.ts","name":null,"original":{"line":51,"column":48},"generated":{"line":1,"column":727}},{"source":"Mail.ts","name":null,"original":{"line":54,"column":2},"generated":{"line":1,"column":730}},{"source":"Mail.ts","name":null,"original":{"line":54,"column":2},"generated":{"line":1,"column":732}},{"source":"Mail.ts","name":null,"original":{"line":54,"column":2},"generated":{"line":1,"column":742}},{"source":"Mail.ts","name":null,"original":{"line":54,"column":2},"generated":{"line":1,"column":755}},{"source":"Mail.ts","name":null,"original":{"line":54,"column":2},"generated":{"line":1,"column":766}},{"source":"Mail.ts","name":null,"original":{"line":54,"column":2},"generated":{"line":1,"column":770}},{"source":"Mail.ts","name":null,"original":{"line":54,"column":2},"generated":{"line":1,"column":772}},{"source":"Mail.ts","name":null,"original":{"line":55,"column":11},"generated":{"line":1,"column":777}},{"source":"Mail.ts","name":null,"original":{"line":55,"column":11},"generated":{"line":1,"column":784}},{"source":"Mail.ts","name":null,"original":{"line":55,"column":15},"generated":{"line":1,"column":788}},{"source":"Mail.ts","name":null,"original":{"line":55,"column":23},"generated":{"line":1,"column":796}},{"source":"Mail.ts","name":null,"original":{"line":55,"column":24},"generated":{"line":1,"column":805}},{"source":"Mail.ts","name":null,"original":{"line":55,"column":33},"generated":{"line":1,"column":807}},{"source":"Mail.ts","name":null,"original":{"line":56,"column":12},"generated":{"line":1,"column":810}},{"source":"Mail.ts","name":null,"original":{"line":56,"column":12},"generated":{"line":1,"column":814}},{"source":"Mail.ts","name":null,"original":{"line":56,"column":21},"generated":{"line":1,"column":816}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":10},"generated":{"line":1,"column":819}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":15},"generated":{"line":1,"column":821}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":26},"generated":{"line":1,"column":832}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":30},"generated":{"line":1,"column":836}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":37},"generated":{"line":1,"column":838}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":41},"generated":{"line":1,"column":843}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":30},"generated":{"line":1,"column":849}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":45},"generated":{"line":1,"column":851}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":50},"generated":{"line":1,"column":853}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":61},"generated":{"line":1,"column":864}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":64},"generated":{"line":1,"column":867}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":70},"generated":{"line":1,"column":873}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":74},"generated":{"line":1,"column":877}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":74},"generated":{"line":1,"column":886}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":83},"generated":{"line":1,"column":889}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":83},"generated":{"line":1,"column":896}},{"source":"Mail.ts","name":null,"original":{"line":58,"column":89},"generated":{"line":1,"column":898}},{"source":"Mail.ts","name":null,"original":{"line":59,"column":10},"generated":{"line":1,"column":909}},{"source":"Mail.ts","name":null,"original":{"line":59,"column":15},"generated":{"line":1,"column":911}},{"source":"Mail.ts","name":null,"original":{"line":59,"column":26},"generated":{"line":1,"column":922}},{"source":"Mail.ts","name":null,"original":{"line":59,"column":34},"generated":{"line":1,"column":930}},{"source":"Mail.ts","name":null,"original":{"line":59,"column":38},"generated":{"line":1,"column":934}},{"source":"Mail.ts","name":null,"original":{"line":59,"column":57},"generated":{"line":1,"column":953}},{"source":"Mail.ts","name":null,"original":{"line":59,"column":64},"generated":{"line":1,"column":955}},{"source":"Mail.ts","name":null,"original":{"line":59,"column":69},"generated":{"line":1,"column":960}},{"source":"Mail.ts","name":null,"original":{"line":59,"column":74},"generated":{"line":1,"column":962}},{"source":"Mail.ts","name":null,"original":{"line":59,"column":85},"generated":{"line":1,"column":973}},{"source":"Mail.ts","name":null,"original":{"line":59,"column":93},"generated":{"line":1,"column":981}},{"source":"Mail.ts","name":null,"original":{"line":59,"column":97},"generated":{"line":1,"column":985}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":10},"generated":{"line":1,"column":1004}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":15},"generated":{"line":1,"column":1006}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":23},"generated":{"line":1,"column":1014}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":32},"generated":{"line":1,"column":1023}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":39},"generated":{"line":1,"column":1030}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":48},"generated":{"line":1,"column":1037}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":51},"generated":{"line":1,"column":1040}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":58},"generated":{"line":1,"column":1042}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":62},"generated":{"line":1,"column":1047}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":51},"generated":{"line":1,"column":1053}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":66},"generated":{"line":1,"column":1055}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":71},"generated":{"line":1,"column":1057}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":79},"generated":{"line":1,"column":1065}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":88},"generated":{"line":1,"column":1074}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":95},"generated":{"line":1,"column":1081}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":99},"generated":{"line":1,"column":1085}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":99},"generated":{"line":1,"column":1094}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":108},"generated":{"line":1,"column":1097}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":108},"generated":{"line":1,"column":1104}},{"source":"Mail.ts","name":null,"original":{"line":60,"column":114},"generated":{"line":1,"column":1106}},{"source":"Mail.ts","name":null,"original":{"line":62,"column":6},"generated":{"line":1,"column":1117}},{"source":"Mail.ts","name":null,"original":{"line":62,"column":14},"generated":{"line":1,"column":1125}},{"source":"Mail.ts","name":null,"original":{"line":62,"column":18},"generated":{"line":1,"column":1129}},{"source":"Mail.ts","name":null,"original":{"line":62,"column":25},"generated":{"line":1,"column":1131}},{"source":"Mail.ts","name":null,"original":{"line":62,"column":29},"generated":{"line":1,"column":1135}},{"source":"Mail.ts","name":null,"original":{"line":62,"column":29},"generated":{"line":1,"column":1144}},{"source":"Mail.ts","name":null,"original":{"line":62,"column":38},"generated":{"line":1,"column":1147}},{"source":"Mail.ts","name":null,"original":{"line":62,"column":38},"generated":{"line":1,"column":1154}},{"source":"Mail.ts","name":null,"original":{"line":62,"column":38},"generated":{"line":1,"column":1156}},{"source":"Mail.ts","name":null,"original":{"line":62,"column":46},"generated":{"line":1,"column":1164}},{"source":"Mail.ts","name":null,"original":{"line":62,"column":66},"generated":{"line":1,"column":1184}},{"source":"Mail.ts","name":null,"original":{"line":62,"column":71},"generated":{"line":1,"column":1186}},{"source":"Mail.ts","name":null,"original":{"line":62,"column":86},"generated":{"line":1,"column":1200}},{"source":"Mail.ts","name":null,"original":{"line":63,"column":9},"generated":{"line":1,"column":1206}},{"source":"Mail.ts","name":null,"original":{"line":63,"column":14},"generated":{"line":1,"column":1211}},{"source":"Mail.ts","name":null,"original":{"line":63,"column":15},"generated":{"line":1,"column":1220}},{"source":"Mail.ts","name":null,"original":{"line":64,"column":16},"generated":{"line":1,"column":1223}},{"source":"Mail.ts","name":null,"original":{"line":64,"column":16},"generated":{"line":1,"column":1227}},{"source":"Mail.ts","name":null,"original":{"line":64,"column":27},"generated":{"line":1,"column":1229}},{"source":"Mail.ts","name":null,"original":{"line":64,"column":35},"generated":{"line":1,"column":1231}},{"source":"Mail.ts","name":null,"original":{"line":64,"column":42},"generated":{"line":1,"column":1238}},{"source":"Mail.ts","name":null,"original":{"line":64,"column":42},"generated":{"line":1,"column":1247}},{"source":"Mail.ts","name":null,"original":{"line":64,"column":49},"generated":{"line":1,"column":1250}},{"source":"Mail.ts","name":null,"original":{"line":64,"column":51},"generated":{"line":1,"column":1258}},{"source":"Mail.ts","name":null,"original":{"line":66,"column":10},"generated":{"line":1,"column":1262}},{"source":"Mail.ts","name":null,"original":{"line":66,"column":18},"generated":{"line":1,"column":1264}},{"source":"Mail.ts","name":null,"original":{"line":66,"column":27},"generated":{"line":1,"column":1266}},{"source":"Mail.ts","name":null,"original":{"line":66,"column":33},"generated":{"line":1,"column":1270}},{"source":"Mail.ts","name":null,"original":{"line":74,"column":2},"generated":{"line":1,"column":1281}},{"source":"Mail.ts","name":null,"original":{"line":74,"column":2},"generated":{"line":1,"column":1283}},{"source":"Mail.ts","name":null,"original":{"line":74,"column":2},"generated":{"line":1,"column":1293}},{"source":"Mail.ts","name":null,"original":{"line":74,"column":2},"generated":{"line":1,"column":1302}},{"source":"Mail.ts","name":null,"original":{"line":75,"column":11},"generated":{"line":1,"column":1313}},{"source":"Mail.ts","name":null,"original":{"line":75,"column":11},"generated":{"line":1,"column":1320}},{"source":"Mail.ts","name":null,"original":{"line":75,"column":16},"generated":{"line":1,"column":1325}},{"source":"Mail.ts","name":null,"original":{"line":75,"column":27},"generated":{"line":1,"column":1336}},{"source":"Mail.ts","name":null,"original":{"line":75,"column":38},"generated":{"line":1,"column":1345}},{"source":"Mail.ts","name":null,"original":{"line":78,"column":2},"generated":{"line":1,"column":1366}},{"source":"Mail.ts","name":null,"original":{"line":78,"column":2},"generated":{"line":1,"column":1368}},{"source":"Mail.ts","name":null,"original":{"line":78,"column":2},"generated":{"line":1,"column":1378}},{"source":"Mail.ts","name":null,"original":{"line":78,"column":2},"generated":{"line":1,"column":1388}},{"source":"Mail.ts","name":null,"original":{"line":79,"column":8},"generated":{"line":1,"column":1399}},{"source":"Mail.ts","name":null,"original":{"line":79,"column":9},"generated":{"line":1,"column":1406}},{"source":"Mail.ts","name":null,"original":{"line":79,"column":14},"generated":{"line":1,"column":1411}},{"source":"Mail.ts","name":null,"original":{"line":79,"column":25},"generated":{"line":1,"column":1422}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":8},"generated":{"line":1,"column":1427}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":13},"generated":{"line":1,"column":1432}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":24},"generated":{"line":1,"column":1443}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":29},"generated":{"line":1,"column":1448}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":34},"generated":{"line":1,"column":1453}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":43},"generated":{"line":1,"column":1460}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":55},"generated":{"line":1,"column":1464}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":60},"generated":{"line":1,"column":1469}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":71},"generated":{"line":1,"column":1480}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":76},"generated":{"line":1,"column":1485}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":81},"generated":{"line":1,"column":1490}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":91},"generated":{"line":1,"column":1500}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":94},"generated":{"line":1,"column":1502}},{"source":"Mail.ts","name":null,"original":{"line":80,"column":101},"generated":{"line":1,"column":1507}},{"source":"Mail.ts","name":null,"original":{"line":81,"column":11},"generated":{"line":1,"column":1513}},{"source":"Mail.ts","name":null,"original":{"line":81,"column":16},"generated":{"line":1,"column":1518}},{"source":"Mail.ts","name":null,"original":{"line":81,"column":27},"generated":{"line":1,"column":1529}},{"source":"Mail.ts","name":null,"original":{"line":81,"column":32},"generated":{"line":1,"column":1534}},{"source":"Mail.ts","name":null,"original":{"line":79,"column":38},"generated":{"line":1,"column":1539}},{"source":"Mail.ts","name":null,"original":{"line":87,"column":2},"generated":{"line":1,"column":1565}},{"source":"Mail.ts","name":null,"original":{"line":87,"column":2},"generated":{"line":1,"column":1567}},{"source":"Mail.ts","name":null,"original":{"line":87,"column":2},"generated":{"line":1,"column":1577}},{"source":"Mail.ts","name":null,"original":{"line":87,"column":2},"generated":{"line":1,"column":1589}},{"source":"Mail.ts","name":null,"original":{"line":88,"column":8},"generated":{"line":1,"column":1600}},{"source":"Mail.ts","name":null,"original":{"line":88,"column":8},"generated":{"line":1,"column":1607}},{"source":"Mail.ts","name":null,"original":{"line":88,"column":13},"generated":{"line":1,"column":1612}},{"source":"Mail.ts","name":null,"original":{"line":89,"column":35},"generated":{"line":1,"column":1641}},{"source":"Mail.ts","name":null,"original":{"line":89,"column":10},"generated":{"line":1,"column":1645}},{"source":"Mail.ts","name":null,"original":{"line":89,"column":15},"generated":{"line":1,"column":1650}},{"source":"Mail.ts","name":null,"original":{"line":89,"column":26},"generated":{"line":1,"column":1661}},{"source":"Mail.ts","name":null,"original":{"line":89,"column":49},"generated":{"line":1,"column":1666}},{"source":"Mail.ts","name":null,"original":{"line":90,"column":13},"generated":{"line":1,"column":1671}},{"source":"Mail.ts","name":null,"original":{"line":90,"column":13},"generated":{"line":1,"column":1673}},{"source":"Mail.ts","name":null,"original":{"line":90,"column":24},"generated":{"line":1,"column":1681}},{"source":"Mail.ts","name":null,"original":{"line":90,"column":35},"generated":{"line":1,"column":1692}},{"source":"Mail.ts","name":null,"original":{"line":90,"column":40},"generated":{"line":1,"column":1697}},{"source":"Mail.ts","name":null,"original":{"line":90,"column":51},"generated":{"line":1,"column":1708}},{"source":"Mail.ts","name":null,"original":{"line":92,"column":49},"generated":{"line":1,"column":1714}},{"source":"Mail.ts","name":null,"original":{"line":92,"column":10},"generated":{"line":1,"column":1718}},{"source":"Mail.ts","name":null,"original":{"line":92,"column":15},"generated":{"line":1,"column":1723}},{"source":"Mail.ts","name":null,"original":{"line":92,"column":26},"generated":{"line":1,"column":1734}},{"source":"Mail.ts","name":null,"original":{"line":92,"column":31},"generated":{"line":1,"column":1739}},{"source":"Mail.ts","name":null,"original":{"line":92,"column":38},"generated":{"line":1,"column":1746}},{"source":"Mail.ts","name":null,"original":{"line":92,"column":59},"generated":{"line":1,"column":1753}},{"source":"Mail.ts","name":null,"original":{"line":93,"column":13},"generated":{"line":1,"column":1758}},{"source":"Mail.ts","name":null,"original":{"line":93,"column":18},"generated":{"line":1,"column":1763}},{"source":"Mail.ts","name":null,"original":{"line":93,"column":29},"generated":{"line":1,"column":1774}},{"source":"Mail.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":1,"column":1780}},{"source":"Mail.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":1,"column":1782}},{"source":"Mail.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":1,"column":1792}},{"source":"Mail.ts","name":null,"original":{"line":97,"column":2},"generated":{"line":1,"column":1813}},{"source":"Mail.ts","name":null,"original":{"line":98,"column":8},"generated":{"line":1,"column":1824}},{"source":"Mail.ts","name":null,"original":{"line":98,"column":8},"generated":{"line":1,"column":1831}},{"source":"Mail.ts","name":null,"original":{"line":98,"column":13},"generated":{"line":1,"column":1836}},{"source":"Mail.ts","name":null,"original":{"line":98,"column":49},"generated":{"line":1,"column":1864}},{"source":"Mail.ts","name":null,"original":{"line":98,"column":54},"generated":{"line":1,"column":1869}},{"source":"Mail.ts","name":null,"original":{"line":98,"column":68},"generated":{"line":1,"column":1883}},{"source":"Mail.ts","name":null,"original":{"line":98,"column":78},"generated":{"line":1,"column":1893}},{"source":"Mail.ts","name":null,"original":{"line":98,"column":81},"generated":{"line":1,"column":1895}},{"source":"Mail.ts","name":null,"original":{"line":98,"column":89},"generated":{"line":1,"column":1901}},{"source":"Mail.ts","name":null,"original":{"line":99,"column":11},"generated":{"line":1,"column":1907}},{"source":"Mail.ts","name":null,"original":{"line":99,"column":16},"generated":{"line":1,"column":1912}},{"source":"Mail.ts","name":null,"original":{"line":105,"column":2},"generated":{"line":1,"column":1927}},{"source":"Mail.ts","name":null,"original":{"line":105,"column":2},"generated":{"line":1,"column":1929}},{"source":"Mail.ts","name":null,"original":{"line":105,"column":2},"generated":{"line":1,"column":1939}},{"source":"Mail.ts","name":null,"original":{"line":105,"column":2},"generated":{"line":1,"column":1947}},{"source":"Mail.ts","name":null,"original":{"line":106,"column":11},"generated":{"line":1,"column":1958}},{"source":"Mail.ts","name":null,"original":{"line":106,"column":11},"generated":{"line":1,"column":1965}},{"source":"Mail.ts","name":null,"original":{"line":106,"column":16},"generated":{"line":1,"column":1970}},{"source":"Mail.ts","name":null,"original":{"line":106,"column":27},"generated":{"line":1,"column":1981}},{"source":"Mail.ts","name":null,"original":{"line":106,"column":35},"generated":{"line":1,"column":1987}},{"source":"Mail.ts","name":null,"original":{"line":106,"column":40},"generated":{"line":1,"column":1992}},{"source":"Mail.ts","name":null,"original":{"line":109,"column":2},"generated":{"line":1,"column":2004}},{"source":"Mail.ts","name":null,"original":{"line":109,"column":2},"generated":{"line":1,"column":2006}},{"source":"Mail.ts","name":null,"original":{"line":109,"column":2},"generated":{"line":1,"column":2016}},{"source":"Mail.ts","name":null,"original":{"line":109,"column":2},"generated":{"line":1,"column":2025}},{"source":"Mail.ts","name":null,"original":{"line":110,"column":10},"generated":{"line":1,"column":2036}},{"source":"Mail.ts","name":null,"original":{"line":110,"column":10},"generated":{"line":1,"column":2040}},{"source":"Mail.ts","name":null,"original":{"line":110,"column":19},"generated":{"line":1,"column":2042}},{"source":"Mail.ts","name":null,"original":{"line":133,"column":11},"generated":{"line":1,"column":2045}},{"source":"Mail.ts","name":null,"original":{"line":112,"column":8},"generated":{"line":1,"column":2052}},{"source":"Mail.ts","name":null,"original":{"line":112,"column":13},"generated":{"line":1,"column":2057}},{"source":"Mail.ts","name":null,"original":{"line":113,"column":6},"generated":{"line":1,"column":2086}},{"source":"Mail.ts","name":null,"original":{"line":113,"column":13},"generated":{"line":1,"column":2088}},{"source":"Mail.ts","name":null,"original":{"line":113,"column":18},"generated":{"line":1,"column":2093}},{"source":"Mail.ts","name":null,"original":{"line":114,"column":8},"generated":{"line":1,"column":2094}},{"source":"Mail.ts","name":null,"original":{"line":114,"column":14},"generated":{"line":1,"column":2099}},{"source":"Mail.ts","name":null,"original":{"line":115,"column":8},"generated":{"line":1,"column":2106}},{"source":"Mail.ts","name":null,"original":{"line":115,"column":15},"generated":{"line":1,"column":2112}},{"source":"Mail.ts","name":null,"original":{"line":119,"column":8},"generated":{"line":1,"column":2175}},{"source":"Mail.ts","name":null,"original":{"line":119,"column":13},"generated":{"line":1,"column":2180}},{"source":"Mail.ts","name":null,"original":{"line":120,"column":6},"generated":{"line":1,"column":2209}},{"source":"Mail.ts","name":null,"original":{"line":120,"column":13},"generated":{"line":1,"column":2211}},{"source":"Mail.ts","name":null,"original":{"line":120,"column":18},"generated":{"line":1,"column":2216}},{"source":"Mail.ts","name":null,"original":{"line":121,"column":8},"generated":{"line":1,"column":2217}},{"source":"Mail.ts","name":null,"original":{"line":121,"column":14},"generated":{"line":1,"column":2222}},{"source":"Mail.ts","name":null,"original":{"line":122,"column":8},"generated":{"line":1,"column":2229}},{"source":"Mail.ts","name":null,"original":{"line":122,"column":15},"generated":{"line":1,"column":2235}},{"source":"Mail.ts","name":null,"original":{"line":126,"column":8},"generated":{"line":1,"column":2299}},{"source":"Mail.ts","name":null,"original":{"line":126,"column":13},"generated":{"line":1,"column":2304}},{"source":"Mail.ts","name":null,"original":{"line":127,"column":6},"generated":{"line":1,"column":2332}},{"source":"Mail.ts","name":null,"original":{"line":127,"column":13},"generated":{"line":1,"column":2334}},{"source":"Mail.ts","name":null,"original":{"line":127,"column":18},"generated":{"line":1,"column":2339}},{"source":"Mail.ts","name":null,"original":{"line":128,"column":8},"generated":{"line":1,"column":2340}},{"source":"Mail.ts","name":null,"original":{"line":128,"column":14},"generated":{"line":1,"column":2345}},{"source":"Mail.ts","name":null,"original":{"line":129,"column":8},"generated":{"line":1,"column":2359}},{"source":"Mail.ts","name":null,"original":{"line":129,"column":15},"generated":{"line":1,"column":2365}},{"source":"Mail.ts","name":null,"original":{"line":133,"column":11},"generated":{"line":1,"column":2402}},{"source":"Mail.ts","name":null,"original":{"line":134,"column":6},"generated":{"line":1,"column":2403}},{"source":"Mail.ts","name":null,"original":{"line":134,"column":13},"generated":{"line":1,"column":2409}},{"source":"Mail.ts","name":null,"original":{"line":134,"column":18},"generated":{"line":1,"column":2414}},{"source":"Mail.ts","name":null,"original":{"line":135,"column":6},"generated":{"line":1,"column":2425}},{"source":"Mail.ts","name":null,"original":{"line":135,"column":19},"generated":{"line":1,"column":2437}},{"source":"Mail.ts","name":null,"original":{"line":135,"column":24},"generated":{"line":1,"column":2442}},{"source":"Mail.ts","name":null,"original":{"line":136,"column":6},"generated":{"line":1,"column":2465}},{"source":"Mail.ts","name":null,"original":{"line":136,"column":17},"generated":{"line":1,"column":2475}},{"source":"Mail.ts","name":null,"original":{"line":136,"column":22},"generated":{"line":1,"column":2480}},{"source":"Mail.ts","name":null,"original":{"line":137,"column":6},"generated":{"line":1,"column":2490}},{"source":"Mail.ts","name":null,"original":{"line":137,"column":14},"generated":{"line":1,"column":2497}},{"source":"Mail.ts","name":null,"original":{"line":138,"column":8},"generated":{"line":1,"column":2498}},{"source":"Mail.ts","name":null,"original":{"line":138,"column":14},"generated":{"line":1,"column":2503}},{"source":"Mail.ts","name":null,"original":{"line":138,"column":19},"generated":{"line":1,"column":2508}},{"source":"Mail.ts","name":null,"original":{"line":140,"column":6},"generated":{"line":1,"column":2521}},{"source":"Mail.ts","name":null,"original":{"line":140,"column":12},"generated":{"line":1,"column":2528}},{"source":"Mail.ts","name":null,"original":{"line":141,"column":6},"generated":{"line":1,"column":2530}},{"source":"Mail.ts","name":null,"original":{"line":141,"column":14},"generated":{"line":1,"column":2537}},{"source":"Mail.ts","name":null,"original":{"line":142,"column":8},"generated":{"line":1,"column":2538}},{"source":"Mail.ts","name":null,"original":{"line":142,"column":14},"generated":{"line":1,"column":2543}},{"source":"Mail.ts","name":null,"original":{"line":146,"column":0},"generated":{"line":1,"column":2573}},{"source":"Mail.ts","name":null,"original":{"line":7,"column":0},"generated":{"line":1,"column":2575}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":2578}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":0},"generated":{"line":1,"column":2586}},{"source":"Mail.ts","name":null,"original":{"line":148,"column":15},"generated":{"line":1,"column":2594}}],"sources":{"Mail.ts":"import { ParsedMail } from 'mailparser';\nimport { SMTPServerDataStream, SMTPServerSession } from 'smtp-server';\nimport { Connection } from 'mysql';\nimport Account from './Account';\nimport htmlToText from 'html-to-text';\n\nclass Mail {\n  mailObject: ParsedMail;\n  stream: SMTPServerDataStream;\n  session: SMTPServerSession;\n  callback: (err: Error) => void;\n  sqlConnection: Connection\n  dateLoaded: Date;\n\n  constructor({\n    mail,\n    stream,\n    session,\n    callback,\n    sqlConnection,\n  }: {\n    mail: ParsedMail,\n    stream: SMTPServerDataStream,\n    session: SMTPServerSession,\n    callback: (err: Error) => void,\n    sqlConnection: Connection\n  }) {\n    this.mailObject = mail;\n    this.stream = stream;\n    this.session = session;\n    this.callback = callback;\n    this.sqlConnection = sqlConnection;\n    this.dateLoaded = new Date();\n  }\n\n  /**\n   * Check if the email requires conversion from HTML to Plain Text.\n   */\n  contentRequiresConversion(): boolean {\n    if (this.mailObject.text) return false;\n    if (this.mailObject.html) return true;\n    return false;\n  }\n\n  contentRequiresTruncation(): boolean {\n    if (this.getContents() === null) return false;\n    return this.getContents().length > 2000;\n  }\n\n  emailContainsAttachments(): boolean {\n    return this.mailObject.attachments.length > 0;\n  }\n\n  getRecipient(): Promise<Account> {\n    return new Promise((resolve, reject) => {\n      const emails = [];\n\n      if (this.mailObject.to) emails.push(...this.mailObject.to.value.map(email => email.address))\n      if (this.mailObject.headers.get('x-forwarded-to')) emails.push(this.mailObject.headers.get('x-forwarded-to'))\n      if (this.session.envelope.rcptTo.length > 0) emails.push(...this.session.envelope.rcptTo.map(email => email.address))\n\n      Promise.all(emails.map(email => Account.getAccountFromEmail(this.sqlConnection, email)))\n        .then((results) => {\n          const accounts = results.filter(acc => !!acc);\n\n          resolve(accounts[0] || null)\n        })\n    })\n  }\n\n  /**\n   * Get the title of the email\n   */\n  getTitle(): string {\n    return this.mailObject.subject || '_Untitled E-Mail_'\n  }\n\n  getAuthor(): string {\n    if (!this.mailObject.from) return '_No Author Identified_'\n    if (this.mailObject.from.text.length > 256) return this.mailObject.from.text.substring(0, 250) + '...';\n    return this.mailObject.from.text\n  }\n\n  /**\n   * Get the plaintext contents of the file\n   */\n  getContents(): string {\n    if (this.contentRequiresConversion()) {\n      if (this.mailObject.html === false) return null\n      return htmlToText.fromString(this.mailObject.html)\n    } else {\n      if (this.mailObject.text.trim().length === 0) return null\n      return this.mailObject.text;\n    }\n  }\n\n  getTruncatedContents(): string {\n    if (this.contentRequiresTruncation()) return this.getContents().substring(0, 1995) + '...';\n    return this.getContents();\n  }\n\n  /**\n   * Get the date of when the email was sent (or arrived)\n   */\n  getDate(): Date {\n    return this.mailObject.date || this.dateLoaded;\n  }\n\n  getEmbed() {\n    const fields = [];\n\n    if (this.contentRequiresConversion()) {\n      fields.push({\n        name: 'Note',\n        value: 'This email has been converted from _HTML_ to _Plain Text_.'\n      })\n    }\n\n    if (this.contentRequiresTruncation()) {\n      fields.push({\n        name: 'Note',\n        value: 'This email has been truncated to fit under 2000 characters.'\n      })\n    }\n\n    if (this.emailContainsAttachments()) {\n      fields.push({\n        name: 'Attachments',\n        value: 'This email contains attachments.'\n      })\n    }\n\n    return {\n      title: this.getTitle(),\n      description: this.getTruncatedContents(),\n      timestamp: this.getDate(),\n      author: {\n        name: this.getAuthor()\n      },\n      fields,\n      footer: {\n        text: 'https://discordmail.com/'\n      }\n    }\n  }\n}\n\nexport default Mail\n"},"lineCount":null}},"error":null,"hash":"804690b3678134c40818bcc4c4023ec9","cacheData":{"env":{}}}